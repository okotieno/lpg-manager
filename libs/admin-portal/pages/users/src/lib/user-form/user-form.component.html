<form [formGroup]="userForm" (ngSubmit)="onSubmit()">
  <ion-row class="ion-margin">
    <ion-col size="12" sizeMd="6">
      <ion-item lines="none">
        <ion-input
          label="First Name"
          labelPlacement="stacked"
          formControlName="firstName"
          placeholder="Enter first name"
          errorText="First name is required"
          helperText="&nbsp;"
        >
        </ion-input>
      </ion-item>
    </ion-col>
    <ion-col size="12" sizeMd="6">
      <ion-item lines="none">
        <ion-input
          label="Last Name"
          labelPlacement="stacked"
          formControlName="lastName"
          placeholder="Enter last name"
          errorText="Last name is required"
          helperText="&nbsp;"
        >
        </ion-input>
      </ion-item>
    </ion-col>
    <ion-col size="12" sizeMd="6">
      <ion-item lines="none">
        <ion-input
          label="Email"
          labelPlacement="stacked"
          formControlName="email"
          type="email"
          placeholder="Enter email address"
          errorText="Valid email is required"
          helperText="&nbsp;"
        >
        </ion-input>
      </ion-item>
    </ion-col>
    <ion-col size="12" sizeMd="6">
      <ion-item lines="none">
        <ion-input
          label="Phone"
          labelPlacement="stacked"
          formControlName="phone"
          type="tel"
          placeholder="Enter phone number"
          helperText="&nbsp;"
        >
        </ion-input>
      </ion-item>
    </ion-col>
  </ion-row>
  <ion-list formArrayName="roles">
    <ion-list-header class="ion-padding-bottom">
      <ion-label>Roles</ion-label>
      <ion-button size="small" (click)="addRole()">
        <ion-icon slot="start" name="plus"></ion-icon>
        Add Role
      </ion-button>
    </ion-list-header>
    @for (role of roles.controls; track $index) {
      <ion-item lines="none" [formGroupName]="$index">
        <ion-row style="width: 100%;" class="ion-margin-horizontal">
          <ion-col size="12" sizeMd="5">
            <lpg-searchable-select
              [itemsStore]="rolesStore"
              label="Role"
              labelPlacement="stacked"
              formControlName="id"
              placeholder="Select roles"
            ></lpg-searchable-select>
          </ion-col>
          <ion-col size="12" sizeMd="5">
            <lpg-searchable-select
              [itemsStore]="rolesStore"
              label="Station"
              labelPlacement="stacked"
              formControlName="stationId"
              placeholder="Select station"
            ></lpg-searchable-select>
          </ion-col>
          <ion-col size="12" sizeMd="2" class="ion-align-self-end">
            <ion-button fill="clear" color="danger" (click)="removeRole($index)">
              <ion-icon name="trash-can"></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-item>
    }

  </ion-list>

  <div class="ion-margin-top ion-text-end">
    <ion-button fill="clear" type="button" [routerLink]="['../../users']">
      Cancel
    </ion-button>
    <ion-button type="submit" [disabled]="!userForm.valid">
      {{ isEditing() ? 'Update' : 'Create' }}
    </ion-button>
  </div>
</form>
