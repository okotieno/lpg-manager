<ion-grid class="ion-padding">
  <!-- Depot Selection -->
  <ion-row class="ion-margin-bottom">
    <ion-col size="12" size-md="6" offset-md="3" [formGroup]="searchForm">
      <lpg-searchable-select
        [itemsStore]="depotStore"
        label="Select Depot"
        labelPlacement="floating"
        placeholder="Search and select depot..."
        formControlName="depot"
      ></lpg-searchable-select>
    </ion-col>
  </ion-row>

  <!-- Search Bar -->
  <ion-row class="ion-margin-bottom">
    <ion-col size="12" size-md="6" offset-md="3">
      <ion-searchbar
        placeholder="Search catalogues..."
        (ionInput)="handleSearch($event)"
        [debounce]="500"
      ></ion-searchbar>
    </ion-col>
  </ion-row>

  <!-- Catalogue Grid -->
  <ion-row>
    @for (catalogue of cataloguesDisplayed(); track catalogue?.id) {
      <ion-col size="12" size-sm="6" size-md="4" size-lg="3">
        <ion-card class="catalogue-card">
          <div class="image-container">
            <ion-img
              [src]="catalogue?.images?.[0]?.url ?? 'no-image-placeholder.webp'"
              class="catalogue-image"
            ></ion-img>
            @if (catalogue?.pricePerUnit) {
              <div class="price-tag">
                {{ catalogue?.pricePerUnit | currency }}
              </div>
            }
          </div>

          <ion-card-header>
            <ion-card-title class="ion-text-wrap">{{ catalogue?.name }}</ion-card-title>
            <ion-card-subtitle>{{ catalogue?.brand?.name }}</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <p class="description">{{ catalogue?.description || 'No description available' }}</p>

            <div class="specs">
              <ion-text color="medium">
                <p>
                  <ion-icon name="cube"></ion-icon>
                  {{ catalogue?.quantityPerUnit }} {{ catalogue?.unit }}
                </p>
              </ion-text>
            </div>
            <ion-buttons style="justify-content: center; align-items: center">
              @if (catalogue.cart) {
                <ion-button color="primary" (click)="updateQuantity(catalogue, false)">
                  <ion-icon name="circle-minus" slot="icon-only"></ion-icon>
                </ion-button>
                <ion-text class="">
                  {{ catalogue.cart?.quantity }}
                </ion-text>
                <ion-button color="primary" (click)="updateQuantity(catalogue, true)">
                  <ion-icon name="circle-plus" slot="icon-only"></ion-icon>
                </ion-button>

                <ion-button color="danger" style="margin-left: auto" (click)="removeFromCart(catalogue)">
                  <ion-icon name="trash-can" slot="icon-only"></ion-icon>
                </ion-button>

              } @else {
                <ion-button class="add-to-cart-button" fill="outline" color="primary" expand="block" (click)="addToCart(catalogue)">
                  <ion-icon name="cart-plus" slot="start"></ion-icon>
                  Add to Cart
                </ion-button>
              }
            </ion-buttons>

          </ion-card-content>
        </ion-card>
      </ion-col>
    }

    @if (!catalogues().length) {
      <ion-col size="12">
        <div class="ion-text-center ion-padding">
          <ion-text color="medium">
            <h2>No catalogues available</h2>
            <p>Try adjusting your search criteria</p>
          </ion-text>
        </div>
      </ion-col>
    }
  </ion-row>
</ion-grid>
