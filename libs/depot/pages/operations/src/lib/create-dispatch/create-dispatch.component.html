<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="operations"></ion-back-button>
    </ion-buttons>
    <ion-title>Create Dispatch</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="dispatchForm" (ngSubmit)="createDispatch()">
    <ion-item>
      <lpg-searchable-select
        [itemsStore]="transporterStore"
        formControlName="transporter"
        label="Select Transporter"
        labelPlacement="floating"
        placeholder="--Select transporter--"
      ></lpg-searchable-select>
    </ion-item>

    <ion-item>
      <lpg-searchable-select
        [itemsStore]="driverStore"
        formControlName="driver"
        label="Select Driver"
        labelPlacement="floating"
        placeholder="--Select driver--"
        [disabled]="!dispatchForm.get('transporter')?.value"
      ></lpg-searchable-select>
    </ion-item>

    <ion-item>
      <lpg-searchable-select
        [itemsStore]="vehicleStore"
        formControlName="vehicle"
        label="Select Vehicle"
        labelPlacement="floating"
        placeholder="--Select vehicle--"
        [disabled]="!dispatchForm.get('transporter')?.value"
      ></lpg-searchable-select>
    </ion-item>

    <ion-item-divider>
      <ion-label>Select Orders</ion-label>
    </ion-item-divider>

    <ion-list>
      @for (order of confirmedOrders(); track order.id) {
        <ion-item>
          <ion-checkbox slot="start" [value]="order.id" (ionChange)="onOrderSelect($event, order)">
          </ion-checkbox>
          <ion-label>
            <h2>Order #{{ order.id }}</h2>
            <p>{{ order.dealer.name }}</p>
            <p>{{ order.totalPrice | currency }}</p>
          </ion-label>
        </ion-item>
      }
    </ion-list>

    <div class="ion-padding">
      <ion-button type="submit" expand="block" [disabled]="!dispatchForm.valid || !selectedOrders.length">
        Create Dispatch
      </ion-button>
    </div>
  </form>
</ion-content> 